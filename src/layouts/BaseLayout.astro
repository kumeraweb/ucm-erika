---
import { SITE } from "../data/site";

// Si este layout es SOLO para el home:
const canonical = SITE.domain.replace(/\/+$/, ""); // https://www.rescatesmedicos.cl

const title = `Unidad Coronaria Móvil (UCM) 24/7 | Asistencia Médica y Rescate a Domicilio`;
const description = `Contrata tu plan con la Unidad Coronaria Móvil (UCM). Asistencia médica 24/7, ambulancias equipadas y cobertura en Santiago y Valparaíso. Cotiza hoy.`;


// Si usas este layout en páginas hijas, pasa canonical por props o usa Astro.url
import '../styles/global.css'
---

<!doctype html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <meta name="robots" content="index,follow,max-image-preview:large" />

    <title>{title}</title>
    <meta name="description" content={description} />
    <!-- meta keywords se puede omitir -->

    <link rel="canonical" href={canonical} />
    <link rel="icon" type="image/png" href="/favicon.png" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Rescate Médico – Planes UCM" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonical} />
    <meta property="og:image" content={`${canonical}/og-ucm.jpg`} />
    <meta property="og:locale" content="es_CL" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={`${canonical}/og-ucm.jpg`} />

    <!-- LocalBusiness / MedicalBusiness Schema -->
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "MedicalBusiness",
        "name": "Planes UCM – Rescate Médico",
        "description": description,
        "url": canonical,
        "image": `${canonical}/og-ucm.jpg`,
        "telephone": `+56${SITE.phone}`, // sin espacios
        "priceRange": "$$",
        "openingHours": "Mo-Su 00:00-23:59",
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": -33.45694,
          "longitude": -70.64827
        },
        "areaServed": [
          { "@type": "Place", "name": "Región Metropolitana de Santiago" },
          { "@type": "Place", "name": "Región de Valparaíso" }
        ],
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Santiago",
          "addressRegion": "Región Metropolitana",
          "addressCountry": "CL"
        },
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "Planes UCM",
          "itemListElement": [
            { "@type": "Offer", "name": "Plan Familiar", "category": "Familiar", "priceCurrency": "CLP" },
            { "@type": "Offer", "name": "Plan Empresas", "category": "Empresas", "priceCurrency": "CLP" }
          ]
        }
        // OJO: No incluir aggregateRating si no tienes reseñas verificables
        // No incluir sameAs a perfiles que no pertenezcan a tu clienta
      })}
    </script>

    <!-- Google Tag (opcional, GA4) -->
    {false && (
      <>
        <link rel="preconnect" href="https://www.googletagmanager.com" />
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXX"></script>
        <script>
          {`window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-XXXXXXX', { send_page_view: true });`}
        </script>
      </>
    )}

    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17545387254"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17545387254');
</script>
</head>

  <body class="bg-slate-50 text-slate-800 antialiased">
    <slot />

    <!-- Tracking de CTAs: GA4 o GTM fallback -->
    <script>
      (function(){
        function track(eventName, params) {
          if (window.gtag) {
            window.gtag('event', eventName, params || {});
          } else if (window.dataLayer) {
            window.dataLayer.push({ event: eventName, ...(params||{}) });
          } else {
            console.log('event', eventName, params || {});
          }
        }

        function onReady(cb) {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', cb);
          } else { cb(); }
        }

        onReady(function () {
          document.querySelectorAll('[data-cta]')?.forEach(function(el){
            el.addEventListener('click', function(){
              const id = el.getAttribute('data-cta') || 'cta';
              track('cta_click', { id });
              if (id.includes('whatsapp')) track('click_whatsapp', { id });
              if (id.includes('llamar') || id.includes('call')) track('click_tel', { id });
            });
          });
        });
      })();
    </script>
  </body>
</html>
