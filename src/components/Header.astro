---
// Header.astro
import { SITE } from '../data/site'

// Asegúrate que cleanPhone sea 569XXXXXXXX (sin +)
const wa = `https://wa.me/${SITE.cleanPhone}?text=Hola%20${encodeURIComponent(SITE.name)}%2C%20quiero%20cotizar%20un%20plan%20UCM&utm_source=site&utm_medium=header&utm_campaign=cta_whatsapp`
const tel = `tel:+56${SITE.cleanPhone}`
---

<a
  href="#contenido"
  class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-white text-slate-900 px-3 py-2 rounded-md shadow"
>
  Saltar al contenido
</a>

<header class="sticky top-0 z-50 bg-white/90 border-b border-slate-200 backdrop-blur-md">
  <!-- Nota anti-confusión -->
  <!-- <div class="hidden md:block text-center text-[11px] md:text-xs text-slate-600 py-1">
    Canal exclusivo para <strong>contratación de planes UCM</strong>. No usar en caso de
    emergencias.
  </div> -->

  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <!-- LOGO -->
    <div class="flex items-center gap-3">
      <a href="/" aria-label="Inicio - Planes UCM | Rescate Médico">
        <img
          src="/logos/logo-ucm.png"
          alt="Planes UCM – Contratación y asesoría"
          class="h-12 md:h-16 w-auto"
          width="160"
          height="64"
          loading="eager"
          decoding="async"
        />
      </a>
    </div>

    <!-- NAV DESKTOP -->
    <nav
      class="hidden md:flex items-center gap-6 text-sm font-medium text-slate-600"
      aria-label="Navegación principal"
    >
      <a href="#planes" class="hover:text-slate-900">Planes</a>
      <a href="#cobertura" class="hover:text-slate-900">Cobertura</a>
      <a href="#contacto" class="hover:text-slate-900">Contacto</a>

      <a
        href={tel}
        class="text-slate-900 hover:underline whitespace-nowrap"
        data-cta="llamar_header"
        aria-label="Llamar a la ejecutiva para contratar un plan UCM"
        rel="nofollow"
      >
        Llamar a ejecutiva: {SITE.phone}
      </a>
    </nav>

    <!-- CTA PRINCIPAL DESKTOP -->
    <a
      href={wa}
      data-cta="whatsapp_header"
      class="hidden md:inline-flex rounded-xl px-3 py-2 md:px-5 md:py-2 bg-emerald-600 text-white font-semibold text-sm shadow hover:bg-emerald-700 focus:outline-none"
      aria-label="Cotizar plan UCM por WhatsApp"
      rel="noopener nofollow"
    >
      Cotizar por WhatsApp
    </a>

    <!-- BOTÓN MENÚ MÓVIL -->
    <button
      type="button"
      class="md:hidden inline-flex items-center justify-center p-2 rounded-md border border-slate-300 text-slate-700"
      aria-label="Abrir menú"
      aria-controls="mobile-menu"
      aria-expanded="false"
      id="menuBtn"
    >
      ☰
    </button>
  </div>

  <!-- MENÚ MÓVIL -->
  <div id="mobile-menu" class="md:hidden hidden border-t border-slate-200 bg-white">
    <nav
      class="max-w-6xl mx-auto px-4 py-3 flex flex-col gap-3 text-sm"
      aria-label="Navegación móvil"
    >
      <a href="#planes" class="py-2">Planes</a>
      <a href="#cobertura" class="py-2">Cobertura</a>
      <a href="#contacto" class="py-2">Contacto</a>

      <a
        href={wa}
        data-cta="whatsapp_header_mobile"
        class="rounded-lg px-4 py-3 bg-emerald-600 text-white font-semibold text-center"
        aria-label="Cotizar plan UCM por WhatsApp"
        rel="noopener nofollow"
      >
        Cotizar por WhatsApp
      </a>

      <a
        href={tel}
        data-cta="llamar_header_mobile"
        class="rounded-lg px-4 py-3 bg-[#204D8D] text-white font-semibold text-center"
        aria-label="Llamar a la ejecutiva para contratar un plan UCM"
        rel="nofollow"
      >
        Llamar a la ejecutiva
      </a>

      <p class="text-[11px] text-slate-500 text-center">
        Canal exclusivo para <strong>contratación de planes</strong>.
      </p>
    </nav>
  </div>
</header>

<!-- Ancla de contenido principal para el skip link -->
<div id="contenido" class="sr-only" aria-hidden="true"></div>

<script>
  // Toggle del menú móvil con accesibilidad
  ;(function () {
    const btn = document.getElementById('menuBtn')
    const menu = document.getElementById('mobile-menu')
    if (!btn || !menu) return

    function toggle(open) {
      const isOpen = open ?? menu.classList.contains('hidden')
      menu.classList.toggle('hidden', !isOpen)
      btn.setAttribute('aria-expanded', String(isOpen))
      btn.setAttribute('aria-label', isOpen ? 'Cerrar menú' : 'Abrir menú')
    }

    btn.addEventListener('click', () => toggle())
    // Cierra menú al navegar a anclas
    menu.querySelectorAll('a[href^="#"]').forEach((a) => {
      a.addEventListener('click', () => toggle(false))
    })
  })()
</script>
