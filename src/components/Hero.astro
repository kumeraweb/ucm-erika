---
import { SITE } from "../data/site";
import Check from "./icons/Check.astro";

interface Props {
  bgImage?: string;
  preloadBg?: boolean;
  showVideo?: boolean;
  videoSrc?: string;
  videoSrcWebm?: string;
  poster?: string;
}
const {
  bgImage = "/media/ambulancias.jpg",
  preloadBg = false,
  showVideo = true,
  videoSrc = "/media/ucm.mp4",
  videoSrcWebm = "",
  poster = "/media/ucm-poster.jpg",
} = Astro.props;

const wa = `https://wa.me/${SITE.cleanPhone}?text=Hola%20${encodeURIComponent(SITE.name)}%2C%20quiero%20cotizar%20UCM&utm_source=site&utm_medium=hero&utm_campaign=cta_whatsapp`;
const call = `tel:+56${SITE.cleanPhone}`;
---

{preloadBg && (
  <Fragment slot="head">
    <link rel="preload" as="image" href={bgImage} imagesrcset={bgImage} />
  </Fragment>
)}

{showVideo && (
  <Fragment slot="head">
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "VideoObject",
        "name": "Unidad Coronaria M√≥vil (UCM) ‚Äì Rescate M√©dico 24/7",
        "description": "Ambulancias avanzadas y atenci√≥n m√©dica a domicilio en Santiago y Regi√≥n de Valpara√≠so. Telemedicina y orientaci√≥n m√©dica 24/7.",
        "thumbnailUrl": [`${SITE.domain}${poster}`],
        "uploadDate": new Date().toISOString(),
        "contentUrl": `${SITE.domain}${videoSrc}`,
        "embedUrl": `${SITE.domain}${videoSrc}`,
      })}
    </script>
  </Fragment>
)}

<section id="hero" class="relative overflow-hidden" aria-labelledby="hero-title">
  <!-- Fondo -->
  <div class="absolute inset-0 -z-10">
    <img
      src={bgImage}
      alt=""
      loading="eager"
      fetchpriority="high"
      decoding="async"
      class="h-full w-full object-cover"
      aria-hidden="true"
    />
    <div class="absolute inset-0 bg-black/45 md:bg-black/40"></div>
    <div class="absolute inset-0 bg-gradient-to-r from-black/35 via-black/25 to-transparent"></div>
  </div>

  <div class="relative">
    <div class="max-w-6xl mx-auto px-4 py-20 md:py-32 grid md:grid-cols-2 items-center gap-10">
      <!-- Columna izquierda: texto -->
      <div class="max-w-2xl">
        <h1 id="hero-title" class="text-4xl md:text-6xl font-extrabold leading-tight text-white drop-shadow-lg">
          Unidad Coronaria M√≥vil (UCM):
          <span class="block">Rescate M√©dico y Ambulancias 24/7</span>
          <span class="block text-rose-400">en Santiago y Regi√≥n de Valpara√≠so</span>
        </h1>

        <p class="mt-6 text-xl text-slate-100/95 leading-relaxed">
          <strong>Ambulancia avanzada</strong> y <strong>atenci√≥n m√©dica a domicilio</strong> con
          <strong>telemedicina</strong> y <strong>orientaci√≥n 24/7</strong>. Te ayudo a elegir y contratar tu plan sin tr√°mites ni esperas.
        </p>

        <ul class="mt-8 space-y-3 text-slate-100 text-lg">
          <li class="flex items-start gap-3">
            <Check class="mt-1 text-emerald-400 shrink-0" size={22} />
            <span>Emergencias y <strong>urgencias m√©dicas</strong> 24 horas</span>
          </li>
          <li class="flex items-start gap-3">
            <Check class="mt-1 text-emerald-400 shrink-0" size={22} />
            <span><strong>Ambulancia avanzada (ALS)</strong> y atenci√≥n prehospitalaria</span>
          </li>
          <li class="flex items-start gap-3">
            <Check class="mt-1 text-emerald-400 shrink-0" size={22} />
            <span><strong>Atenci√≥n a domicilio</strong> + <strong>telemedicina</strong> inmediata</span>
          </li>
          <li class="flex items-start gap-3">
            <Check class="mt-1 text-emerald-400 shrink-0" size={22} />
            <span>Orientaci√≥n m√©dica telef√≥nica <strong>ilimitada</strong></span>
          </li>
        </ul>

        <div class="mt-8 flex flex-wrap gap-4">
          <a
            href={wa}
            data-cta="whatsapp_hero"
            class="rounded-xl w-full text-center px-7 py-4 text-lg bg-emerald-600 text-white font-semibold hover:bg-emerald-700 shadow-lg"
          >
            Cotizar por WhatsApp
          </a>
          <a
            href={call}
            data-cta="call_hero"
            class="rounded-xl w-full text-center px-7 py-4 text-lg bg-[#204D8D] text-white font-semibold hover:bg-[#1b3f74] shadow-lg"
          >
            Llamar ahora
          </a>
        </div>

        <p class="mt-4 text-slate-200/90 text-sm">
          Cobertura: <a href="#cobertura" class="underline hover:no-underline">Santiago (RM)</a> ¬∑
          <a href="#cobertura" class="underline hover:no-underline">Vi√±a del Mar</a> ¬∑
          <a href="#cobertura" class="underline hover:no-underline">Valpara√≠so</a>
        </p>
      </div>

      <!-- Columna derecha: video -->
      {showVideo && (
        <figure class="relative md:justify-self-end">
          <div class="rounded-2xl backdrop-blur border border-white/60 shadow-xl p-3 md:p-28">
            <div class="relative w-full max-w-[380px] md:max-w-[420px]">
              <div class="aspect-[9/16] overflow-hidden rounded-xl">
                <video
                  id="heroVideo"
                  class="h-full w-full object-cover"
                  title="Presentaci√≥n Unidad Coronaria M√≥vil (UCM)"
                  poster={poster}
                  preload="metadata"
                  muted
                  playsinline
                  autoplay
                  loop
                >
                  {videoSrcWebm && <source src={videoSrcWebm} type="video/webm" />}
                  {videoSrc && <source src={videoSrc} type="video/mp4" />}
                  Tu navegador no puede reproducir el video.
                </video>
              </div>
              <button
                type="button"
                id="unmuteBtn"
                class="absolute bottom-3 right-3 rounded-full bg-slate-900/80 text-white text-xs px-3 py-2 hover:bg-black"
                aria-label="Activar sonido del video"
                aria-pressed="false"
              >
                üîä Activar sonido
              </button>
            </div>
          </div>
          <figcaption class="sr-only">Ambulancias y atenci√≥n 24/7 de la Unidad Coronaria M√≥vil (UCM).</figcaption>
        </figure>
      )}
    </div>
  </div>
</section>

<script>
  // Activar audio con interacci√≥n
  const v = document.getElementById('heroVideo');
  const b = document.getElementById('unmuteBtn');
  if (v && b) {
    b.addEventListener('click', () => {
      try {
        v.muted = false;
        v.volume = 0.2;
        const p = v.play();
        if (p && p.catch) p.catch(() => {});
        b.setAttribute('aria-pressed', 'true');
        b.style.display = 'none';
      } catch (_) {}
    });
  }
</script>
